name: Process Newspaper PDF

# Trigger: Runs when a PDF is uploaded to uploads/ folder
on:
  push:
    paths:
      - 'uploads/**.pdf'

# Give GitHub Actions permission to commit changes
permissions:
  contents: write

jobs:
  convert-and-publish:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Get the code
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v3

      # Step 2: Setup Python
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Step 3: Install required tools
      - name: ğŸ› ï¸ Install Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y poppler-utils
          pip install Pillow

      # Step 4: Run the processing script
      - name: âš™ï¸ Run Processing Script
        run: python scripts/process_pdf.py

      # Step 5: Commit and push changes
      - name: ğŸ’¾ Save Changes
        run: |
          git config --global user.name "Tom City Robot"
          git config --global user.email "robot@tom-city-edition.in"
          git add papers/ app.js uploads/ index.html assets/
          git commit -m "ğŸ¤– Auto-published edition $(date +'%d-%m-%Y')" || echo "No changes to commit"
          git push
